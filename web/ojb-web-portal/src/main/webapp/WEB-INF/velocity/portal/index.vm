<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie6"> <![endif]-->
<!--[if IE 7 ]> <html class="ie7"> <![endif]-->
<!--[if IE 8 ]> <html class="ie8"> <![endif]-->
<!--[if IE 9 ]> <html class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html> <!--<![endif]-->
<html>
	<head>
		#parse("common/_head.vm")
	</head>
	<body data-spy="scroll" data-target=".navbar">
		#parse("common/_header.vm")
	    <!-- Begin page content -->
	    
	    <div class="container-fluid small">
		    <div id="loadingAjaxPane"></div>
		    <div id="portalContent">
		      <div>Welcome to the new portal</div>
		    </div>
	    </div>
	    
		<footer class="footer">
			<div class="container" align="center">
				<span class="text-muted small">OJBC Portal Footer</span>
			</div>
		</footer>	
		<!-- /.container -->
		
		#parse("common/_javascripts.vm")
		
		<script>

			var idleTime;
			
			$(function(){
				#if( $inactivityTimeout )
			        reloadPage();
			        $('html').on('mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick', function () {
			            clearTimeout(idleTime);
			            reloadPage();
			        });
		        #end
		        
				$("#demogFilterInfo").hide();
				
			 	$(document).ajaxStart(function(){
			 	     		
<!--			 		if( $("#addSubscriptionDialog").dialog("isOpen") === true){-->	
<!--			 			$("#modalIframeSpinner").height($("#addSubscriptionDialog").height())-->	
<!--			 			$("#modalIframeSpinner").width($("#addSubscriptionDialog").width())-->	
<!--						$("#modalIframeSpinner").show();-->	
<!--			-->	
<!--			 		}-->	
<!--			 		else if ($("#editSubscriptionDialog").dialog("isOpen") === true){-->	
<!--			 			$("#modalIframeSpinner").height($("#editSubscriptionDialog").height())-->	
<!--			 			$("#modalIframeSpinner").width($("#editSubscriptionDialog").width())-->	
<!--						$("#modalIframeSpinner").show();-->	
<!--			 		}-->	
<!--			 		else{ -->
			     		var loadingDiv =  $("#loadingAjaxPane");
			     		var portalContentDiv = $("#portalContent");
						
			     		loadingDiv.height(portalContentDiv.height());
			     		loadingDiv.width(portalContentDiv.width());
			     		
			          	$("#loadingAjaxPane").show();          	
<!--			 		}     	-->	     	
			      }).ajaxStop(function() {
			    	  $("#loadingAjaxPane").hide();                
			      	  $("#modalIframeSpinner").hide();
			      });
			      
				#if( $sensitiveInfoAlert )
					 bootpopup({
                       title: "NOTICE TO USERS", 
                       showclose: false,
                       content: [
                             { p: {text: "$sensitiveInfoAlertMessage"}},
                             ], 
                       cancel: function() {},
                       ok: function(data, array, event) {  
			        		$.post("#springUrl('/portal/negateSenstiveInfoAlert')", function() {
							}).fail(ojbc.displayFailMessage);
                       },
                     });
			    #end
			    
			    $('#homeLink').click (function() {		 
					 		     
				    #set($homePage=$stateSpecificHomePage['thisHomePage'])
				      
				    #if($homePage=="landingPage")
				    
						$('#searchBarButtonDiv').css("display", "none");
				    	$('#filterColumn').css('visibility', 'visible');
				    
				    	//TODO likely needs refactor(2 jquery ajax asynch calls in a row)
						ojbc.populateLeftBarContentFromUrl("#springUrl('/portal/landingLeftBar')");
				    	ojbc.populatePortalContentFromUrl("#springUrl('/portal/landingPage')");
				    
				    #elseif($homePage=="query")	
				    	 
						$('#searchBarButtonDiv').css("display", "block");
				    		    
						// TODO cleanup these nested jquery ajax calls to make them easier to read		    		    			    		    
						$.post("#springUrl('/portal/leftBar')", function(data) {
							    		    			
			    			$('#filterColumn').html(data);	 
			    			
			    			$("#demogFilterInfo").hide();
			    			
			    			$('#filterColumn').css('visibility', 'visible');    				    			 
			    			
							$.get("#springUrl('/people/searchForm')", function(data) {		
										
							      $('#portalContent').html(data);
							      
							}).fail(ojbc.displayFailMessage);	    				    				    			
			    			
			    		}).fail(ojbc.displayFailMessage);	
			    		
			    	#elseif($homePage=="subscriptions")
			    	
			    		xhr = $.post("#springUrl('/subscriptions/subscriptionResults')", function(data) {
			    		
							$('#portalContent').html(data);	
																	
							$.post("#springUrl('/portal/subscriptionsLeftBar')", function(data) {
								    	
				    			$('#filterColumn').html(data);
				    			$('#filterColumn').css('visibility', 'visible');
				    			 
				    		}).fail(ojbc.displayFailMessage);
																			      
						}).fail(ojbc.displayFailMessage);								    
			    			    			    		
				    #else
						alert('Error: unknown page cannot be displayed');
				    #end
		
				    return false;
				})
		
				//note some members may not be using this help id(which is being listened to here) 
				// but rather they may be using a different help id (which is not listened to here)
				$('#helpLink').click (function() {  
											
					$('#searchBarButtonDiv').css("display", "none");
				    $('#filterColumn').css('visibility', 'visible');
		
				    ojbc.populateLeftBarContentFromUrl("#springUrl('/help/helpLeftBar')");
		
				    ojbc.populatePortalContentFromUrl("#springUrl('/help/introduction')");
							    
				    return false;							       	        	
				})
		
				$('#queryLink').click (function() {
						
				    $('#searchBarButtonDiv').css("display", "block");
						   
					// TODO cleanup these nested jquery ajax calls to make them easier to read		    		    			    		    
					$.post("#springUrl('/portal/leftBar')", function(data) {
						    		    			
		    			$('#filterColumn').html(data);	 
		    			
		    			$("#demogFilterInfo").hide();
		    			
		    			$('#filterColumn').css('visibility', 'visible');    				    			 
		    			
						$.get("#springUrl('/people/searchForm')", function(data) {		
									
						      $('#portalContent').html(data);
						      
						}).fail(ojbc.displayFailMessage);	    				    				    			
		    			
		    		}).fail(ojbc.displayFailMessage);			    
				    					   
				    return false;
				});
		    		 
				$('#leftMenu').on("click", "#subscriptionsLink", function() {	  
			  				  				  					  					    			    	
					xhr = $.post("#springUrl('/subscriptions/subscriptionResults')", function(data) {
						$('#portalContent').html(data);
					}).done(function(){	
																
						$.post("#springUrl('/portal/subscriptionsLeftBar')", function(data) {
							    	
			    			$('#filterColumn').html(data);
			    			$('#filterColumn').css('visibility', 'visible');
			    			 
			    		}).fail(ojbc.displayFailMessage);
																		      
					}).fail(ojbc.displayFailMessage);
					
					return false;
				});
		    		 
				$('#rapbackLink').click(function() {	  
			  				  				  					  					    			    	
		    		xhr = $.post("#springUrl('/rapbacks/rapbackDefaultSearch')", function(data) {
						$('#portalContent').html(data);	
					}).done(function(){
						$.post("#springUrl('/portal/rapbackLeftBar')", function(data) {
										    	
			    			$('#filterColumn').html(data);
			    			$('#filterColumn').css('visibility', 'visible');
			    		}).fail(ojbc.displayFailMessage);
					}).fail(ojbc.displayFailMessage);
									    
					return false;
				});
				
				$('#criminalIdLink').click(function() {	  
		    		xhr = $.post("#springUrl('/rapbacks/criminalIdentificationDefaultSearch')", function(data) {
		    		
						$('#portalContent').html(data);	
													
					}).done(function(){
					    $.post("#springUrl('/portal/criminalIdentificationLeftBar')", function(data) {
							    	
			    			$('#filterColumn').html(data);
			    			$('#filterColumn').css('visibility', 'visible');
			    		}).fail(ojbc.displayFailMessage);
					}).fail(ojbc.displayFailMessage);
									    
					return false;
				});
				
				$('#faqLink').click (function() {	  
				  		
				    $('#searchBarButtonDiv').css("display", "none");
				    $('#filterColumn').css('visibility', 'visible');
		
					//TODO possible refactor to avoid 2 ansync jquery ajax calls in a row
				    ojbc.populateLeftBarContentFromUrl("#springUrl('/portal/landingLeftBar')");
		
				    ojbc.populatePortalContentFromUrl("#springUrl('/portal/faq')");
							    
				    return false;
				});
		    		 
				$('#suggestionFormLink').click (function() {	    
						
				    $('#searchBarButtonDiv').css("display", "none");
				    $('#filterColumn').css('visibility', 'visible');
		
					//TODO possible refactor to avoid 2 ansync jquery ajax calls in a row
				    ojbc.populateLeftBarContentFromUrl("#springUrl('/portal/landingLeftBar')");
		
				    ojbc.populatePortalContentFromUrl("#springUrl('/suggestion/suggestionForm')");
							    
				    return false;
				})
		    		 
				$('#adminLink').click (function() {	    
						
				    $('#searchBarButtonDiv').css("display", "none");
		
		    		xhr = $.get("#springUrl('/subscriptions/admin/landingPage')", function(data) {
						$('#portalContent').html(data);	
					}).done(function(){
						$.post("#springUrl('/portal/subscriptionsLeftBar')", function(data) {
										    	
			    			$('#filterColumn').html(data);
			    			$('#filterColumn').css('visibility', 'visible');
			    		}).fail(ojbc.displayFailMessage);
					}).fail(ojbc.displayFailMessage);
									    					    
				    return false;
				})
    		 
			    
			});
		
			#foreach($entry in $stateSpecificHomePage.entrySet())
			 	#set($homePage="$entry.getValue()")
			#end
			  
			#if($homePage=="landingPage")
			
				$("#searchBarButtonDiv").hide();
				$.get("#springUrl('/portal/landingPage')", function(data) {
					$('#portalContent').html(data);
				}).fail(function(data) {$('#portalContent').html(data); });
			
			#elseif($homePage=="query")
			
				$.get("#springUrl('/people/searchForm')", function(data) {
					$('#portalContent').html(data);
				}).fail(function(data) {$('#portalContent').html(data); });
			
			#elseif($homePage=="subscriptions")
			
				$("#searchBarButtonDiv").hide();
			
				$.post("#springUrl('/subscriptions/subscriptionResults')", function(data) {
				
					$('#portalContent').html(data);	
															
					$.post("#springUrl('/portal/subscriptionsLeftBar')", function(data) {
						    	
		    			$('#filterColumn').html(data);
		    			$('#filterColumn').css('visibility', 'visible');
		    			 
		    		}).fail(ojbc.displayFailMessage);
																	      
				}).fail(ojbc.displayFailMessage);	
			#end
			
			function reloadPage() {
			    clearTimeout(idleTime);
			    idleTime = setTimeout(function () {
			        window.location.assign("#springUrl('/portal/performLogout')");
			    }, $inactivityTimeoutInSeconds * 1000);
			}
			
		</script>
		
	</body>
</html>
